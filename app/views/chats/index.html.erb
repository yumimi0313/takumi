<!-- app/views/chats/index.html.erb -->

<h1>Chat with GPT-3.5 Turbo</h1>

<%= form_with url: search_chats_path, method: :post, local: true, id: "search-form" do |f| %>
  <div class="form-group">
    <%= f.label :query, "Enter your query:" %>
    <%= f.text_field :query, class: "form-control" %>
  </div>
  <%= f.submit "Search", class: "btn btn-primary" %>
<% end %>

<div id="result" class="mt-4"></div>

<%= button_to "Generate Text", generated_text_chats_path, method: :post, remote: true, id: "generate-text-button", class: "btn btn-secondary mt-4" %>
<div id="generated-text" class="mt-4"></div>

<script>
  document.getElementById("search-form").addEventListener("submit", function(event) {
    event.preventDefault();

    let form = event.target;
    let formData = new FormData(form);
    let resultContainer = document.getElementById("result");

    fetch(form.action, {
      method: "POST",
      body: formData,
      headers: {
        "X-Requested-With": "XMLHttpRequest",
        "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content,
      },
    })
      .then((response) => response.json())
      .then((data) => {
        resultContainer.innerHTML = `<h2>Generated Text:</h2><p>${data.result}</p>`;
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  });

  document.getElementById("generate-text-button").addEventListener("ajax:success", function(event) {
    let detail = event.detail;
    let data = detail[0];
    let generatedTextContainer = document.getElementById("generated-text");

    generatedTextContainer.innerHTML = `<h2>Generated Text:</h2><p>${data.result}</p>`;
  });

  document.getElementById("generate-text-button").addEventListener("ajax:error", function(event) {
    console.error("Error:", event.detail);
  });
</script>